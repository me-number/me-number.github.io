<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- 适配全面屏 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>
  <meta name='description' content='{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}'>

  <!-- 【核心修复】解决 Google "不是绝对网址" 错误 -->
  <!-- 逻辑：先拼接绝对域名，再移除末尾的 index.html -->
  <link rel="canonical" href="{{ page.url | absolute_url | replace:'index.html','' }}">
  
  <!-- RSS 建议也使用 absolute_url -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title | escape }}" href="{{ '/feed.xml' | absolute_url }}">

  <!-- 1. 性能优化：预加载 LCP 关键图片 -->
  {% if site.logo %}
  <link rel="preload" as="image" href="{{ site.logo | relative_url }}" fetchpriority="high">
  {% endif %}
  {% if page.image and page.url != "/" %}
  <link rel="preload" as="image" href="{{ page.image | relative_url }}" fetchpriority="high">
  {% endif %}

  <!-- 2. 性能优化：预加载本地字体 -->
  <link rel="preload" href="{{ '/fonts/fa-solid-900.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="{{ '/fonts/fa-regular-400.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="{{ '/fonts/fa-brands-400.woff2' | relative_url }}" as="font" type="font/woff2" crossorigin>

  <!-- 3. 加载主 CSS (带时间戳防缓存) -->
  <link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}">

  <noscript>
    <link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}?v={{ site.time | date: '%Y%m%d%H%M' }}">
  </noscript>

  <!-- 5. 主题色切换与背景锁定脚本 -->
  <script>
    (function() {
      var theme = localStorage.getItem("theme");
      var config = "{{ site.color_scheme }}";
      var isDark = theme === "dark" || (!theme && window.matchMedia("(prefers-color-scheme: dark)").matches);
      var initialBg = isDark ? "#121212" : "#ffffff";
      document.documentElement.style.backgroundColor = initialBg;

      if (config === "auto" || config === "") {
        if (isDark) {
          document.documentElement.setAttribute("dark", "");
          document.documentElement.classList.add('dark-mode');
        }
      } else if (config === "dark") {
        document.documentElement.setAttribute("dark", "");
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>

  <!-- 6. 全平台禁止缩放脚本 -->
  <script defer>
    (function() {
      document.addEventListener('keydown', function (e) {
        if ((e.ctrlKey || e.metaKey) && ['+', '-', '=', '0'].includes(e.key)) e.preventDefault();
      }, { passive: false });
      document.addEventListener('wheel', function (e) {
        if (e.ctrlKey || e.metaKey) e.preventDefault();
      }, { passive: false });
      document.addEventListener('touchstart', function (e) {
        if (e.touches.length > 1) e.preventDefault();
      }, { passive: false });
      let lastTouch = 0;
      document.addEventListener('touchend', function (e) {
        const now = Date.now();
        if (now - lastTouch <= 300) e.preventDefault();
        lastTouch = now;
      }, false);
    })();
  </script>
</head>
